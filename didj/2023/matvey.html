<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>didj 2023 matvey</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="../d.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
</head>
<body>
<div class="article__text">
    <header class="titleDidj">
        <div class="didj__logo">
            <button>
                <p>
                    <span id="light" class="mama">светло</span> / <span id="dark">темно</span>
                </p>
            </button>
            <a href="index.html" class="glowing-svg">
                <svg xmlns="http://www.w3.org/2000/svg" width="250" height="33" viewBox="0 0 250 33" fill="none">
                    <path d="M9.87795 33H0V19.4118H0.592677C14.975 19.2953 14.8564 13.8212 14.8564 0H52.1951V19.4118H60.0579V26.0118L60.1764 33H50.259V27.1765H9.87795V33ZM40.3415 19.4118V7.76471H24.7344C24.7344 12.8506 23.8651 16.6165 22.2846 19.4118H40.3415Z" fill="black"/>
                    <path d="M76.4161 27.1765H62.5475V0H74.401V16.7718L97.2783 0H111.542V27.1765H99.6885V10.1329L76.4161 27.1765Z" fill="black"/>
                    <path d="M123.436 33H113.558V19.4118H114.15C128.533 19.2953 128.414 13.8212 128.414 0H165.753V19.4118H173.616V26.0118L173.734 33H163.817V27.1765H123.436V33ZM153.899 19.4118V7.76471H138.292C138.292 12.8506 137.423 16.6165 135.842 19.4118H153.899Z" fill="black"/>
                    <path d="M190.416 27.1765H174.137L196.462 10.8318L181.645 0H197.923L206.142 6.01765V0H217.995V6.01765L226.214 0H242.493L227.676 10.8318L250 27.1765H233.721L219.536 16.8106L217.995 17.9365V27.1765H206.142V17.9365L204.601 16.8106L190.416 27.1765Z" fill="black"/>
                </svg>
            </a>
        </div>
        <p class="text__shadow_matvey_1">
            Матвей Мухорин
        </p>
        <h1 class="text__shadow_matvey_2">
            Пара па про оптический поток
        </h1>
    </header>
    <section>
        <h2>
            Дайте мне белые крылья...
        </h2>
        <p>
            Представьте ситуацию. Лето. Август. 8 утра. Вы просыпаетесь оттого, что в комнату входит отец. Он вручает вам крылья и говорит: "Полетели". И затем продолжает: "Не поднимайся слишком высоко; солнце растопит воск. Не лети слишком низко; морская вода попадёт на перья, и они намокнут".
        </p>
        <p>
            Полёт стартует с горы Ида - самой высокой на острове Кипр. Отец говорит, что крылья будут работать нормально, если лететь на уровне этой вершины.
        </p>
        <p>
            Отлично! Т.е. при старте будет нужная высота.</br>
            Из минусов - никаких приборов для измерения высоты с собой не будет. Но жить очень хочется. Поэтому придётся пораскинуть мозгами.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/1.png" alt="">
            </div>
        </div>
        <h2>
            Формальная постановка задачи
        </h2>
        <p>
            Проанализируем ситуация. Откуда во время полёта мы сможем взять данные о высоте? Что меняется при полете на разных высотах? Сделаем рисунок:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/2.png" alt="">
            </div>
        </div>
        <p>
            Из него видим, что в зависимости от высоты, перемещение камня будет занимать разную часть поля зрения габлюдателя (чем  выше наблюдатель, тем меньше часть).
        </p>
        <p>
            Сделаем фото в момент пролёта над камнем. И через время dt:
        </p>
        <div class="section__picture">
            <div class=""></div>
            <div class="">
                <img src="img/matvey/3.png" alt="">
            </div>
        </div>
        <p>
            В зависимости от высоты движение, оцененное из фотографии, будет различаться. Движение, которое оценивают по картинке, называют оптическим потоком.
        </p>
        <p>
            Получается, что чтобы не разбиться необходимо:
        </p>
        <p>
            В начале полёта:
            <ul>
                <li>+ Запомнить оптический поток для камня под горой</li>
            </ul>
        </p>
        <p>
            Во время полёта:
            <ul>
                <li>
                    + Посчитать оптический поток для ближайшего камня
                </li>
                <li>
                    + Сравнить с начальным
                </li>
                <li>
                    + Откорректировать свою высоту, чтобы оптический поток стал как в начале
                </li>
            </ul>
        </p>
        <h2>Оптический поток</h2>
        <p>
        <strong>Постановка задачи:</strong>Добавим немного киберпанка. Запрограммируем наши крылья так, чтобы они сами производили оценку оптического потока и возвращались на нужную высоту при отклонениях.
        </p>
        <p>
            Для этого нужно составить алгоритм.
        </p>
        <p>
            Формализуем задачу:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/4.png" alt="">
            </div>
        </div>
        <p>
            На входе имеем:
        <ul>
            <li>
                + 2 кадра снятые последовательно
            </li>
        </ul>
        </p>
        <p>
            На выходе хотим получить:
        <ul>
            <li>
                + Оптический поток
            </li>
        </ul>
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/5.png" alt="">
            </div>
        </div>
        <p>
            Т.е. мы для каждого фрагмента изображения первого кадра задаём вектор, который показывает, куда этот фрагмент переместился в следующем кадре.
        </p>
        <h2>
            Предположения
        </h2>
        <p>
            Далее нужно как-то из этих данных вытащить оптический поток. Для этого построим модель - выделим ряд свойств системы.
        </p>
        <p>
            1. При перемещении обьекты не изменяют свою интенсивность.
        </p>
        <p>
            Это утверждение может нарушаться, если будет меняться освещение. Например, появятся тучи. Но мы рассчитываем на солнечный день.
        </p>
        <p>
            2. Движение между кадрами мало.
        </p>
        <p>
            Т.е. расстояние, на которое сместился объект в кадре порядка одного-двух пикселей. Это свойство зависит от того, как часто камера будет делать снимки, и от того, как двигаются объекты в кадре.
        </p>
        <p>
            Выразим первое свойство на математическом языке:
        <ul>
            <li>
                I(x, y, t) = I(x + u, y + v, t + 1)
            </li>
            <li>
                I(x, y, t) - функция интенсивности:
            </li>
        </ul>
        </p>
        <p>
            + Принимает на вход координаты и фрагмента и время снятия кадра.</br>
            + Выдает интенсивность фрагмента с указанными координатами в указанный момент времени.
        </p>
        <p>
            u, v - компоненты перемещения фрагмента:
        <ul>
            <li>
                + u - горизонтальная
            </li>
            <li>
                + v - вертикальная
            </li>
        </ul>
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/6.png" alt="">
            </div>
        </div>
        <p>
            Теперь второе:
        </p>
        <p>
            Если движения в кадре маленькое, то мы можем выразить приращение функции через производную.
        </p>
        <p>
            Подобно одномерному случаю:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/7.png" alt="">
            </div>
        </div>
        <p>
            Для нашей функции интенсивности получаем:
        <ul>
            <li>
                I(x + u, y + v, t + 1) = I(x, y, t) + I_x * u + I_y * v + I_t * 1
            </li>
        </ul>
            I_x, I_y, I_t - здесь это константы, производные по горизонтали, вертикали и времени. u и v - переменные.
        </p>
        <p>
            Объединяя первое и второе свойства, получим:
        <ul>
            <li>
                I(x, y, t) = I(x, y, t) + I_x * u + I_y * v + I_t * 1
            </li>
        </ul>
        </p>
        <p>
            Сократим на I(x, y, t) и получим:
        <ul>
            <li>
                I_x * u + I_y * v + I_t = 0
            </li>
        </ul>
        </p>
        <p>
            Это уравнение накладывает связь на ($u$, $v$), но не определяет их точно:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/8.png" alt="">
            </div>
        </div>
        <p>
            Конец искомого перемещения должен лежать на прямой u(v). Таких векторов можно придумать бесконечно много (красные вектора на картинке). Любой такой вектор можно разложить на сумму двух компонент: зеленая (перпендикулярна прямой) + голубая (параллельна). Причём зелёная у всех подходящих векторов одинаковая. А голубая может быть любой.
        </p>
        <p>
            Причина такой неоднозначности сидит в предположении о малом перемещении. Мы выразили приращение функции через производные, предполагая. Такое можно провернуть только нахлдясь в маленькой окрестности точки. Но рассматривая окрестность, не всегда можно однозначно определить полное движение тела. В миру эта проблема называется:
        </p>
        <h2>
            Aperture problem
        </h2>
        <p>
            Представим,что мы смотрим в дверной глазок. И видим там кусок арматуры.
        </p>
        <p>
            Мы немного пугаемся и отходим от глазка. Но любопытство берет верх и мы опять подходим посмотреть, что там происходит.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/9.png" alt="">
            </div>
        </div>
        <p>
            Арматурина подвинулась.
        </p>
        <p>
            Можем ли мы по этим данным однозначно определить как двигалась арматурина?
        </p>
        <p>
            В примере она двигалась слева направо в горизонтальном направлении. Но движение слева направо в диагональном направлении дало бы неотличимый результат.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/10.png" alt="">
            </div>
        </div>
        <p>
            Чтобы однозначно определить движение нужно наложить дополнительное ограничение на систему.
            Например, такое:
        </p>
        <p>
            Будем предполагать, что близлежащие фрагменты двигаются одинаково. На тот же вектор (u, v).
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/11.png" alt="">
            </div>
        </div>
        <p>
            Тогда одинокое уравнение превращается в систему:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/12.png" alt="">
            </div>
        </div>
        <p>
            Геометрически эту систему можно интерпертировать как пересечение двух прямых:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/13.png" alt="">
            </div>
        </div>
        <p>
            Найдя точку пересечения, найдём и решение!
        </p>
        <p>
            Если мы возьмём в оборот больше соседних фрагментов, то система уже не будет решаться. Но, тем не менее, можно найти точку, которая ну ооочень похожа на решение:
        </p>
        <div class="section__picture">
            <div class="section__picture_text">
                <p>
                    Более строго - ищем точку, которая даёт оптимальный ответ в смысле метода наименьших квадратов. Привет вычматы.
                </p>
            </div>
            <div class="">
                <img src="img/matvey/14.png" alt="">
            </div>
        </div>
        <h2>
            К нашим баранам
        </h2>
        <p>
            Отлично! Теперь мы сможем найти скорость камня, сравнить с начальной и откорректировать высоту полёта.
        </p>
        <h2>
            Где ещё применяется?
        </h2>
        <p>
            Подобный анализ движения по последовательности кадров встречается в разных областях.
        </p>
        <h2>
            Анализ изображений
        </h2>
        <p>
            Применяя алгоритм поиска передвижений к медицинским снимкам, можно оценить изменение размеров частей организма. Например, анализ движения брюшной артерии при дыхании:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/15.png" alt="">
            </div>
        </div>
        <h2>
            Трекинг точек
        </h2>
        <p>
            Также можно следить за движением отдельных точек. Например, точек губ. Анализ такого движения позволяет считывать эмоции.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/16.png" alt="">
            </div>
        </div>
        <h2>
            Камеры скорости
        </h2>
        <p>
            Задача очень похожа на задачку с полётом. Оцениваем скорость проходящих машин. Если скорость превышает предел, то высылаем штраф.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/17.png" alt="">
            </div>
        </div>
        <h2>
            Получение информации о пространстве
        </h2>
        <p>
            Предметы, которые находятся ближе к наблюдателю будут иметь больший оптический поток. Это один из примеров - как можно использовать информацию об оптическом потоке для ориентации в пространстве. Полезно для дронов, автономных машин и прочих железяк.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/18.png" alt="">
            </div>
        </div>
        <p>
            Кроме того, братья наши меньше тоже исопользуют оптический поток. Например, птицы стараются лететь так, чтобы оптический поток слева и справа был примерно равный. Если оптический поток с одной стороны становится слишком большим, они двигаются в противоположную сторону, чтобы его скомпенсировать.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/19.png" alt="">
            </div>
        </div>
        <p>
            Крутая пчела, которая тоже использует оптический поток в быту:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/20.png" alt="">
            </div>
        </div>
        <h2>
            Проблемы метода
        </h2>
        <p>
            Рассмотренный ранее подход определения поток с помощью решения системы называется методом Лукаса-Канаде.
        </p>
        <p>
            Одна из его проблем заключается в том, что мы предполагали, что движение в кадре маленькое. Это не всегда верно.
        </p>
        <p>

            Для решения этой проблемы применяется coarse-to-fine("от грубого к точному") пирамида.
        </p>
        <p>
            Сначала мы создаём копии изображения с более низким разрешением (в изображении становится меньше пикселей). Примерно так:
        </p>
        <div class="section__picture">
            <div class="section__picture_text">
                <p>
                    серым - предмет в предыдущем кадре, красным - в новом
                </p>
            </div>
            <div class="">
                <img src="img/matvey/21.png" alt="">
            </div>
        </div>
        <p>
            Пикселей стало меньше. Раньше предмет занимал 4 пикселя. После понижения разрешения предмет станет занимать 1 пиксель. Изображение при этом становится похоже на пиксель-арт.
        </p>
        <p>
            Чтобы вы лучше ощутили, посмотрите на coarse-to-fine пирамиду для изображения шакала:
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/22.png" alt="">
            </div>
        </div>
        <p>
            Т.к. предмет расплылся и количество фрагментов уменьшилось, то и движение в изображении стало занимать меньше пикселей. Это движение удовлетворяет введенному ранее условию "маленькости" движения. К такому изображению можно применить метод Лукаса-Канаде.
        </p>
        <p>
            Полученные вектора могут быть использованы, как грубое приближение движение следующем уровне (с большим разрешением). На этом уровне считаем уточнение грубых векторов с предыдущего уровня. Такое уточнение тоже будет занимать мало пикселей. Чтобы найти его, опять применим метод Лукаса-Канаде. Затем перейдём на следующий уровень. И так пока не дойдём до уровня с исходным разрешением.
        </p>
        <div class="section__picture">
            <div class="">
                <img src="img/matvey/23.png" alt="">
            </div>
        </div>
        <h2>
            Ссылки
        </h2>
        <p>
            <a href="https://youtu.be/tIwpDuqJqcE?si=ILyC_w9qrZsZRZXi">Optical Flow - Michael Black - MLSS 2013 Tübingen</a>. Ёмкое введение в тему оптического потока. Метод Horn–Schunck'а. Улучшения классических алгоритмов.
        </p>
        <p>
            <a href="https://youtu.be/KoMTYnlNNnc?si=46hHjp0Zj2RrZyoU">CVFX Lecture 13: Optical flow</a>. Темы сильно пересекаются с лекцией Michael Black. Лампово рисует ручкой на бумаге.
        </p>
        <p>
            <a href="https://en.wikipedia.org/wiki/Phase_correlation">Phase Correlation</a>. Метод фазовой корреляции справляется с задачами, когда изображение просто сместилось в пространстве. Например, так:
        </p>
        <div class="section__picture">
            <div class="section__picture_text">
                <p>
                    Основывается на теореме о запаздывании для преобразования Фурье (да-да, она где-то используется).
                </p>
            </div>
            <div class="">
                <img src="img/matvey/6.png" alt="">
            </div>
        </div>
        <p>
            <a href="https://szeliski.org/Book/">Computer Vision: Algorithms and Applications, 2nd ed., глава 9</a>. Рассмотренно больше методов. Есть ссылки на научные статьи.
        </p>
    </section>
</div>
<footer>
    <div class="big__screen">
        <a href="liza.html"class="traffic__screen big__screen_left" >
            <img src="img/prev.png" alt="">
            <img  class="traffic__sign" src="img/bottom.png" alt="">
        </a>

        <a href="danya.html" class="traffic__screen big__screen_right">
            <img src="img/next.png" alt="">
            <img  class="traffic__sign" src="img/bottom.png" alt="">
        </a>
    </div>
    <div class="traffic__screen small__screen">
        <a href="danya.html"> <img src="img/next.png" alt=""></a>
        <a href="liza.html"> <img src="img/prev.png" alt=""></a>
        <img  class="traffic__sign" src="img/bottom.png" alt="">
    </div>
</footer>
<script src="main.js"></script>
</body>
</html>
